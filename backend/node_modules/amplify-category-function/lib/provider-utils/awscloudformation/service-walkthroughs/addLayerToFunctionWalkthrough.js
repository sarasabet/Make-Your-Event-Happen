"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.addLayersToFunctionWalkthrough = void 0;
const addLayerToFunctionUtils_1 = require("../utils/addLayerToFunctionUtils");
const layerParams_1 = require("../utils/layerParams");
const confirmationPrompt = 'Do you want to configure Lambda layers for this function?';
const addLayersToFunctionWalkthrough = async (context, runtime, previousSelections = [], defaultConfirm = false) => {
    let lambdaLayers = [];
    let dependsOn = [];
    if (!(await context.amplify.confirmPrompt(confirmationPrompt, defaultConfirm))) {
        return { lambdaLayers: previousSelections, dependsOn };
    }
    let askArnQuestion;
    ({ lambdaLayers, dependsOn, askArnQuestion } = await addLayerToFunctionUtils_1.askLayerSelection(layerParams_1.getLayerMetadataFactory(context), context.amplify.getProjectMeta(), runtime.value, previousSelections, context.amplify.pathManager.getBackendDirPath()));
    if (askArnQuestion) {
        lambdaLayers = lambdaLayers.concat(await addLayerToFunctionUtils_1.askCustomArnQuestion(lambdaLayers.length, previousSelections));
    }
    if (lambdaLayers.length === 0) {
        context.print.info('No Lambda layers were selected');
        if (previousSelections.length > 0) {
            const plural = previousSelections.length > 1 ? 's' : '';
            const removeMessage = `Removing ${previousSelections.length} previously added Lambda layer${plural} from Lambda function`;
            context.print.info(removeMessage);
        }
    }
    lambdaLayers = await addLayerToFunctionUtils_1.askLayerOrderQuestion(lambdaLayers, previousSelections);
    return { lambdaLayers, dependsOn };
};
exports.addLayersToFunctionWalkthrough = addLayersToFunctionWalkthrough;
//# sourceMappingURL=addLayerToFunctionWalkthrough.js.map